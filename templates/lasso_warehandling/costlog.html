{% extends "admin/base_site.html" %}
{% load adminmedia %}
{% load admin_list %}
{% load i18n %}
{% load i18next %}
{% load datatypes %}

{% block extrastyle %}{{ block.super }}<link rel="stylesheet" type="text/css" href="{% admin_media_prefix %}css/dashboard.css" />{% endblock %}

{% block coltype %}flex{% endblock %}

{% block bodyclass %}costlog{% endblock %}

{% if not is_popup %}
  {% block breadcrumbs %}
    <div class="breadcrumbs">
      <a href="{% url admin:index %}">
        {% trans "Home" %}
      </a>
       &rsaquo; 
       <a href="{% url admin:app_list app_label="lasso_warehandling" %}">
         {% trans "Warehandling" %}
      </a>
      &rsaquo; 
      {% trans "Cost log" %}
    </div>
  {% endblock %}
{% endif %}

{% block content_title %}<h1>{% trans "Cost listing" %}</h1>{% endblock %}

{% block content %}
  <form method="GET" action="{% url lasso_warehandling.views.costlog %}">
    {{ config_form.as_p }}
    <input type="submit" value="{% trans "Go" %}">
  </form>

  <div id="changelist" class="module">
    <table cellspacing="0">
      <thead>
	<tr>
	  <th>{% trans "Date" %}</th>
	  <th class="align-right">{% trans "Gross transaction" %}</th>
	  <th class="align-right">{% trans "Nett transaction" %}</th>
	  <th class="align-right">{% trans "Transaction units" %}</th>
	  <th>{% trans "Transaction details" %}</th>
	  <th class="align-right">{% trans "Gross saldo" %}</th>
	  <th class="align-right">{% trans "Entry cost" %}</th>
	  <th class="align-right">{% trans "Withdrawal cost" %}</th>
	  <th class="align-right">{% trans "Insurance cost" %}</th>
	  <th class="align-right">{% trans "Storage cost" %}</th>
	  <th class="align-right">{% trans "Cost" %}</th>
	</tr>
      </thead>
      <tbody>
	{% for date in dates %}
	  {% with storage_log|nth:date as items_for_date %}
	    <tr class="{% cycle 'row1' 'row2' %}">
	      <td>{{ date|date:"Y-m-d" }}</td>
	      <td class="align-right">{{ items_for_date.sum_in.gross_weight|separateminus:items_for_date.sum_out.gross_weight }}</td>
	      <td class="align-right">{{ items_for_date.sum_in.nett_weight|separateminus:items_for_date.sum_out.nett_weight }}</td>
	      <td class="align-right">{{ items_for_date.sum_in.units|separateminus:items_for_date.sum_out.units }}</td>
	      <td>
		{% for entry in items_for_date.entry_items.values %}
		  <a href="{% url admin:lasso_warehandling_entry_change entry.entry.id %}">{{ entry.id_str }}</a>{% if not forloop.last %},{% endif %}
		{% endfor %}
		{% if items_for_date.withdrawal_items %}- {% endif %}
		{% for entry in items_for_date.withdrawal_items.values %}
		  <a href="{% url admin:lasso_warehandling_withdrawal_change entry.withdrawal.id %}">{{ entry.id_str }}</a>{% if not forloop.last %},{% endif %}
		{% endfor %}
	      </td>
	      <td class="align-right">{{ items_for_date.sum.gross_weight }}</td>
	      <td class="align-right">{{ items_for_date.sum_in.entry_cost|floatformat:"-2" }}</td>
              <td class="align-right">{{ items_for_date.sum_out.cost|floatformat:"-2" }}</td>
	      <td class="align-right">{{ items_for_date.sum_in.insurance_cost|floatformat:"-2" }}</td>
	      <td class="align-right">{{ items_for_date.sum.cost|floatformat:"-2" }}</td>
	      <td class="align-right">{{ items_for_date.sum.total_cost|floatformat:"-2" }}</td>
	      <td></td>
	    </tr>
	  {% endwith %}
	{% endfor %}
	<tfoot>
	<tr>
	  <td>{% trans "Sum" %}</th>
	  <td class="align-right">{{ sum_in.gross_weight|separateminus:sum_out.gross_weight }}</td>
	  <td class="align-right">{{ sum_in.nett_weight|separateminus:sum_out.nett_weight }}</td>
	  <td class="align-right">{{ sum_in.units|separateminus:sum_out.units }}</td>
	  <td></td>
	  <td></td>
	  <td class="align-right">{{ sum_in.entry_cost|floatformat:"-2" }}</td>
          <td class="align-right">{{sum_out.cost|floatformat:"-2" }}</td>
	  <td class="align-right">{{ sum_in.insurance_cost|floatformat:"-2" }}</td>
	  <td class="align-right">{{ sum.cost|floatformat:"-2" }}</td>
	  <td class="align-right">{{ sum.total_cost|floatformat:"-2" }}</td>
	</tr>
        </tfoot>
      </tbody>
    </table>
  </div>
{% endblock %}
